
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Cocoa Discord Utils Guide</title>
        <meta name="description" content="Guide for Cocoa Discord Utils" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" 
            href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/styles/github-dark.min.css" 
            integrity="sha512-rO+olRTkcf304DQBxSWxln8JXCzTHlKnIdnMUwYvQa9/Jd4cQaNkItIUj6Z4nvW1dqK0SKXLbn9h4KwZTNtAyw==" 
            crossorigin="anonymous" referrerpolicy="no-referrer" 
        />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/@tailwindcss/typography@0.5.x/dist/typography.min.css"
        />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css?family=Inter"
        />
    </head>
    <body>
        <article class="prose prose-lg sm:prose-xl lg:prose-2xl">
            <a href="../docs/index.html">Guide Index</a>
            <a href="../index.html">TypeDoc Index</a>
            <h1 id="command-management-system">Command Management System</h1>
<p>ah muck, I wrote this file for so long and accidently delete it.</p>
<p><em>muck</em></p>
<p>Anyway, let&#39;s get into the rewritten one, hope I don&#39;t delete it again.</p>
<h2 id="prerequisite">Prerequisite</h2>
<p>To understand this guide, you need to know:</p>
<ul>
<li><p>discord.js</p>
</li>
<li><p>SlashCommandBuilder (@discordjs/builders) or JSON Structure of Slash Command</p>
</li>
</ul>
<h2 id="understand-the-concept">Understand the Concept</h2>
<p>The Command Management System in this library is inspired by discord.py&#39;s
cog system. It is similar but not identical to.</p>
<p>The Cog is a collection of Commands, and one bot may run multiple Cogs.</p>
<p>There are two implementations of the system.</p>
<ol>
<li><p>Object Cog - Build on concept of one command per file.</p>
</li>
<li><p>Class Cog - Similar syntax to discord.py&#39;s Cog system.</p>
</li>
</ol>
<p>Because I&#39;m lazy with the reason given above. I&#39;m going to talk only about
Slash Commands.</p>
<p>Message Commands will be similar to but have some important differences.
See <a href="https://github.com/CarelessDev/harunon.js">harunon.js</a></p>
<h2 id="object-cog">Object Cog</h2>
<h3 id="create-a-command">Create a Command</h3>
<pre><code class="language-ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">ping</span>: <span class="hljs-title class_">CocoaSlash</span> = {
    <span class="hljs-attr">command</span>: <span class="hljs-title class_">CocoaBuilder</span>(<span class="hljs-string">&quot;ping&quot;</span>, <span class="hljs-string">&quot;pong!&quot;</span>).<span class="hljs-title function_">toJSON</span>(),
    <span class="hljs-attr">func</span>: <span class="hljs-keyword">async</span> (ctx) =&gt; {
        <span class="hljs-keyword">await</span> ctx.<span class="hljs-title function_">reply</span>(<span class="hljs-string">&quot;pong!&quot;</span>);
    },
}
</code></pre>
<p><strong>Note</strong>: CocoaSlash is a utility function that returns SlashCommandBuilder</p>
<pre><code class="language-ts"><span class="hljs-title class_">CocoaBuilder</span>(<span class="hljs-string">&quot;ping&quot;</span>, <span class="hljs-string">&quot;pong!&quot;</span>)
<span class="hljs-comment">// Returns</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">SlashCommandBuilder</span>().<span class="hljs-title function_">setName</span>(<span class="hljs-string">&quot;ping&quot;</span>).<span class="hljs-title function_">setDescription</span>(<span class="hljs-string">&quot;pong!&quot;</span>)
<span class="hljs-comment">// You can continue extend the SlashCommandBuilder normally</span>
</code></pre>
<p>The goal of this function is to reduce the amount of frequently used code.</p>
<p><strong>Remark</strong>:</p>
<ul>
<li><p>Cocoa Discord Utils does not provide Slash Command Builder,
you will need to use <code>SlashCommandBuilder</code> from <code>@discordjs/builders</code> or <code>CocoaBuilder</code> that will eventually returns <code>SlashCommandBuilder</code></p>
</li>
<li><p>Please refer to <code>discord.js</code> documents on how to handle interaction</p>
</li>
</ul>
<p>Also, please keep in mind that this package is utility and not framework.</p>
<p><del>Because I ever made a framework that is easy to implement and it ends up
being a garbage. Visit <a href="https://www.npmjs.com/package/s-bot-framework">here</a></del></p>
<h3 id="create-a-cog">Create a Cog</h3>
<pre><code class="language-ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">mainCog</span>: <span class="hljs-title class_">CogSlash</span> = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Main Cog&quot;</span>,
    <span class="hljs-attr">description</span>: <span class="hljs-string">&quot;This is the main cog&quot;</span>,
    <span class="hljs-attr">commands</span>: {
        ping,
    },
}
</code></pre>
<p><strong>Note</strong>: The key of <code>commands</code> must match the name of its command in SlashCommandBuilder.
In order to ensure this, you are encouraged to run a function which will be
mentioned in the next section.</p>
<h3 id="slash-command-center">Slash Command Center</h3>
<pre><code class="language-ts"><span class="hljs-keyword">const</span> center = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SlashCenter</span>(
    client,
    process.<span class="hljs-property">env</span>.<span class="hljs-property">GUILD_IDS</span>?.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;,&quot;</span>) ?? []
);
<span class="hljs-comment">// addCog for adding 1 Cog, addCogs for multiple Cogs</span>
<span class="hljs-comment">// However, addCogs also works on adding 1 Cog</span>
center.<span class="hljs-title function_">addCogs</span>(mainCog);
center.<span class="hljs-title function_">validateCommands</span>();
</code></pre>
<p><code>SlashCenter.validateCommands()</code> need to be called after all cogs are added
to ensure that the condition mentioned above is met.</p>
<h2 id="class-cog">Class Cog</h2>
<p><em>This syntax is inspired by discord.py</em></p>
<p>Just to let you know that behind this beautiful syntax, it is achieved using
dark magic. (See source code <a href="https://github.com/Leomotors/cocoa-discord-utils/blob/main/src/slash/class/index.ts">here</a>).
But nothing to worry about it! Based on testing, it never break.
So, it is marked as <code>stable</code> now.</p>
<p><strong>To use Class Cog</strong>, We will need to extend the base class given,
and implement methods/commands with decorator.</p>
<p>The <code>CogClass</code> are based on Object Cog, so we can add it to management center
in the <del>same</del> similar way as the Object Cog.</p>
<p><em>Definition for <code>CogSlashClass</code></em></p>
<pre><code class="language-ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CogSlashClass</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CogSlash</span>
</code></pre>
<p><strong>Example of Class Cog</strong></p>
<pre><code class="language-ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainCog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">CogSlashClass</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
        <span class="hljs-variable language_">super</span>(<span class="hljs-string">&quot;Main Cog&quot;</span>, <span class="hljs-string">&quot;This is the main cog&quot;</span>);
    }

    <span class="hljs-comment">// Normal Way</span>
    <span class="hljs-meta">@SlashCommand</span>(<span class="hljs-title class_">CocoaBuilder</span>(<span class="hljs-string">&quot;ping&quot;</span>, <span class="hljs-string">&quot;pong!&quot;</span>).<span class="hljs-title function_">toJSON</span>())
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">ping</span>(<span class="hljs-params">ctx: CommandInteraction</span>) {
        <span class="hljs-keyword">await</span> ctx.<span class="hljs-title function_">reply</span>(<span class="hljs-string">&quot;pong!&quot;</span>);
    }

    <span class="hljs-comment">// NEW!</span>
    <span class="hljs-meta">@SlashCommand</span>(<span class="hljs-title class_">AutoBuilder</span>(<span class="hljs-string">&quot;pong!&quot;</span>))
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">ping</span>(<span class="hljs-params">ctx: CommandInteraction</span>) {
        ...
    }
    <span class="hljs-comment">// With AutoBuilder, you can omit the name field,</span>
    <span class="hljs-comment">// it will take the name from the method name</span>
    <span class="hljs-comment">// From 1.2.0, with CogSlashClass, you can omit .toJSON()</span>

    <span class="hljs-comment">// Always note that there is limitation on how you can name command</span>
    <span class="hljs-comment">// But discord.js will throw error at start time, so nothing to worry about</span>
}
</code></pre>
<p>The library will automatically bind your method to an instance, so you can use
it like a class. Like, add some methods or properties!</p>
<p>And to add it to Slash Center just like Object Cog</p>
<pre><code class="language-ts">center.<span class="hljs-title function_">addCogs</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MainCog</span>());
</code></pre>
<p>Because CogSlashClass implements CogSlash, we can add it to Slash Center and even mix it with Object Cog.</p>
<p><strong>Note</strong>: Due to some TypeScript mumbo jumbo, you are required to explicitly 
specify type in your method arguments.</p>
<p><em>Argument Name can be changed, but must specify the correct type</em></p>
<p><strong>Warning</strong>: Extending Cog Class is not supported, decorators may behave unexpectly</p>
<h2 id="message-command">Message Command</h2>
<p>To invoke a message command, user need to meets two criteria.</p>
<ul>
<li><p>Mention or Global Prefix</p>
</li>
<li><p>Command Name and Arguments</p>
</li>
</ul>
<p><em>Note: This is similar to discord.py&#39;s cogs</em></p>
<h3 id="message-center">Message Center</h3>
<pre><code class="language-ts"><span class="hljs-keyword">const</span> mcenter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageCenter</span>(client, { <span class="hljs-attr">prefixes</span>: [<span class="hljs-string">&quot;simp&quot;</span>] });
</code></pre>
<p><em>In this example, our bot will only listen to message with prefix simp</em></p>
<pre><code class="language-ts"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainCog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">CogMessageClass</span> {
    <span class="hljs-comment">// constructor omitted</span>

    <span class="hljs-meta">@MessageCommand</span>({
        <span class="hljs-comment">// This can be omitted, the decorator will use `name` from function name</span>
        <span class="hljs-comment">// name: &quot;ping&quot;,</span>
        <span class="hljs-attr">aliases</span>: [<span class="hljs-string">&quot;ing&quot;</span>],
        <span class="hljs-attr">description</span>: <span class="hljs-string">&quot;pong!&quot;</span>,
    })
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">ping</span>(<span class="hljs-params">msg: Message, strp: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-keyword">await</span> msg.<span class="hljs-title function_">reply</span>(<span class="hljs-string">&quot;pong!&quot;</span>);
    }
}
</code></pre>
<p>User can invoke <code>ping</code> command by sending <code>simpping</code> or <code>simping</code></p>
<p><code>strp</code> (Stripped Content) is <code>message.content</code> that removed prefix or mentions
and command name</p>
<p><em>For example</em></p>
<pre><code class="language-ts"><span class="hljs-comment">// Command: play (using prefixes: [&quot;simp&quot;])</span>
<span class="hljs-string">&quot;simpplay The Rumbling&quot;</span>
<span class="hljs-comment">// strippedContent is equal to</span>
<span class="hljs-string">&quot;The Rumbling&quot;</span>

<span class="hljs-comment">// Command: submit (using mention: true)</span>
<span class="hljs-string">&quot;&lt;@bot_id&gt; submit cancel_1112 ```py\nimport os; os.system(&#x27;sudo reboot&#x27;);```&quot;</span>
<span class="hljs-comment">// strippedContent is equal to</span>
<span class="hljs-string">&quot;cancel_1112 ```py\nimport os; os.system(&#x27;sudo reboot&#x27;);```&quot;</span>
</code></pre>
<p><em><code>message.content</code> is remained unmodified, you can access full message there too</em></p>
<h2 id="help-command">Help Command</h2>
<p>Both <code>MessageCenter</code> and <code>SlashCenter</code> is capable of generating help command, make sure to call them in right order.</p>
<p>The help command is named <code>help</code> in <code>Help</code> Cog, so beware not to create cog or command with the same name.</p>
<pre><code class="language-js">scenter.<span class="hljs-title function_">addCogs</span>( <span class="hljs-comment">/* all your cogs */</span>);
<span class="hljs-comment">// * Help Command, must be called after All Cogs are added</span>
scenter.<span class="hljs-title function_">useHelpCommand</span>(style);
<span class="hljs-comment">// * BUT before Validate Commands</span>
scenter.<span class="hljs-title function_">validateCommands</span>();
scenter.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;error&quot;</span>, <span class="hljs-comment">/* if you wanna set */</span>);
<span class="hljs-comment">// * REMINDER: syncCommands should be used in client.on(&quot;ready&quot;)</span>
</code></pre>
<h2 id="event-handler">Event Handler</h2>
<p><a href="./cms_evt.html">Event Handler for Management Center</a></p>
<h2 id="ps">PS</h2>
<p>See <a href="https://github.com/Leomotors/cocoa-grader">cocoa-grader</a> and <a href="https://github.com/CarelessDev/harunon.js">harunon.js</a></p>
<h2 id="advanced-feature-specific-guild-command">Advanced Feature: Specific-Guild Command</h2>
<p>You may want some specific commands to be available to specific guilds,
this is where Specific-Guild Command is here.</p>
<p>First, when you create a Command Center, you will need to add Guild IDS
to constructor arguments. This is default or base guild ids which will
be used for every commands.</p>
<pre><code class="language-ts"><span class="hljs-keyword">new</span> <span class="hljs-title class_">SlashCenter</span>(client, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]);
</code></pre>
<p>For each command, you can override the guild ids it is targeting to,
by adding field <code>guild_ids</code> for Object Cog, or <code>second argument</code> in Class Cog.</p>
<pre><code class="language-ts"><span class="hljs-comment">// Instead of syncing to 1 and 2 (Default), sync to 1 and 3 instead</span>
<span class="hljs-meta">@SlashCommand</span>(<span class="hljs-title class_">AutoBuilder</span>(...), [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>])
</code></pre>
<p>The library will take care of unioning the guild ids, so you can think of them
as <code>Default</code> and <code>Override</code></p>
<h3 id="how-does-it-works">How does it works</h3>
<p>For Message Command, if this feature is enabled 
(by specifying guild_ids in constructor), the library will check if the message
is created in the allowed guild and respond to it.</p>
<p>For Slash Command, the library will only sync the command to the guilds specified,
it also do a cleanup in case you change the values.</p>

        </article>
    </body>
    <style>
        body {
            font-family: "Inter";
            width: 100vw;
            background-color: #f4e1d4;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        h1 {
            font-weight: 900 !important;
        }

        li::marker {
            content: "";
        }

        article {
            margin: 0 auto;
            padding: 2rem;
            width: 100vw;
            background-color: white;
            min-height: 100vh;
        }

        @media (min-width: 1024px) {
            article {
                width: 66vw;
            }
        }

        @media (min-width: 1536px) {
            article {
                width: 50vw;
            }
        }
    </style>
</html>